install wazyh manager
=======================

# cat > /etc/yum.repos.d/wazuh.repo <<\EOF
[wazuh_repo]
gpgcheck=1
gpgkey=https://packages.wazuh.com/key/GPG-KEY-WAZUH
enabled=1
name=Wazuh repository
baseurl=https://packages.wazuh.com/3.x/yum/
protect=1
EOF


# yum install wazuh-manager
# systemctl status wazuh-manager

Installing the Wazuh API
=========================
# curl --silent --location https://rpm.nodesource.com/setup_6.x | bash -
# yum install nodejs

# yum install wazuh-api
# systemctl status wazuh-api

Installing Filebeat
===================

    # rpm --import https://packages.elastic.co/GPG-KEY-elasticsearch

    # cat > /etc/yum.repos.d/elastic.repo << EOF
    [elasticsearch-6.x]
    name=Elasticsearch repository for 6.x packages
    baseurl=https://artifacts.elastic.co/packages/6.x/yum
    gpgcheck=1
    gpgkey=https://artifacts.elastic.co/GPG-KEY-elasticsearch
    enabled=1
    autorefresh=1
    type=rpm-md
    EOF

    Install Filebeat:

    # yum install filebeat-6.1.2

# curl -so /etc/filebeat/filebeat.yml https://raw.githubusercontent.com/wazuh/wazuh/3.1/extensions/filebeat/filebeat.yml
#vi /etc/filebeat/filebeat.yml
filebeat:
 prospectors:
  - input_type: log
    paths:
     - "/var/ossec/logs/alerts/alerts.json"
    document_type: json
    json.message_key: log
    json.keys_under_root: true
    json.overwrite_keys: true

output:
 logstash:
   # The Logstash hosts
   hosts: ["192.168.100.2:5000"]
#   ssl:
#     certificate_authorities: ["/etc/filebeat/logstash.crt"]

# systemctl daemon-reload
# systemctl enable filebeat.service
# systemctl start filebeat.service

nstall Elastic Stack with RPM packages
========================================
# curl -Lo jre-8-linux-x64.rpm --header "Cookie: oraclelicense=accept-securebackup-cookie" "http://download.oracle.com/otn-pub/java/jdk/8u161-b12/2f38c3b165be4555a1fa6e98c45e0808/jre-8u161-linux-x64.rpm"
# rpm -qlp jre-8-linux-x64.rpm > /dev/null 2>&1 && echo "Java package downloaded successfully" || echo "Java package did not download successfully"
# yum install jre-8-linux-x64.rpm
# rm jre-8-linux-x64.rpm

rpm --import https://packages.elastic.co/GPG-KEY-elasticsearch


# cat > /etc/yum.repos.d/elastic.repo << EOF
[elasticsearch-6.x]
name=Elasticsearch repository for 6.x packages
baseurl=https://artifacts.elastic.co/packages/6.x/yum
gpgcheck=1
gpgkey=https://artifacts.elastic.co/GPG-KEY-elasticsearch
enabled=1
autorefresh=1
type=rpm-md
EOF

# yum install elasticsearch-6.1.2

# systemctl daemon-reload
# systemctl enable elasticsearch.service
# systemctl start elasticsearch.service

     oad Wazuh Elasticsearch templates:

    # curl https://raw.githubusercontent.com/wazuh/wazuh/3.1/extensions/elasticsearch/wazuh-elastic6-template-alerts.json | curl -XPUT 'http://localhost:9200/_template/wazuh' -H 'Content-Type: application/json' -d @-

    # curl https://raw.githubusercontent.com/wazuh/wazuh/3.1/extensions/elasticsearch/wazuh-elastic6-template-monitoring.json | curl -XPUT 'http://localhost:9200/_template/wazuh-agent' -H 'Content-Type: application/json' -d @-

    Insert sample alert:

    # curl https://raw.githubusercontent.com/wazuh/wazuh/3.1/extensions/elasticsearch/alert_sample.json | curl -XPUT "http://localhost:9200/wazuh-alerts-3.x-"`date +%Y.%m.%d`"/wazuh/sample" -H 'Content-Type: application/json' -d @-


Logstash

Logstash is the tool that will collect, parse, and forward to Elasticsearch for indexing and storage all logs generated by Wazuh server. For more info please see Logstash.

    Install the Logstash package:

    # yum install logstash-6.1.2
    
    curl -so /etc/logstash/conf.d/01-wazuh.conf https://raw.githubusercontent.com/wazuh/wazuh/3.1/extensions/logstash/01-wazuh-local.conf
    
    # usermod -a -G ossec logstash
    
curl -so /etc/logstash/conf.d/01-wazuh.conf https://raw.githubusercontent.com/wazuh/wazuh/3.1/extensions/logstash/01-wazuh-remote.conf


# systemctl daemon-reload
# systemctl enable logstash.service
# systemctl start logstash.service

# yum install kibana-6.1.2

#export NODE_OPTIONS="--max-old-space-size=3072"
# /usr/share/kibana/bin/kibana-plugin install https://packages.wazuh.com/wazuhapp/wazuhapp.zip

vim  /etc/kibana/kibana.yml

Uncomment the setting server.host and change the value to:

server.host: "0.0.0.0"

# systemctl daemon-reload
# systemctl enable kibana.service
# systemctl start kibana.service

Disable the Elasticsearch repository:
=====================================
sed -i "s/^enabled=1/enabled=0/" /etc/yum.repos.d/elastic.repo

curl localhost:5601


    Click on Add new API.

# cd /var/ossec/api/configuration/auth
# node htpasswd -c user myUserName
# systemctl restart wazuh-api
# service wazuh-api restart

Fill Username and Password with appropriate credentials you created in previous step. Enter http://MANAGER_IP for the URL, where MANAGER_IP is the real IP address of the Wazuh qserver. Enter “55000” for the Port







